<html>

<head>

<style>
body {    margin: 40px; }


/*
:root {
	  --stimwordWord1:  22;
}
*/


.wrapper {
    display: grid;
    max-width: 1000px;
    grid-gap: 10px;
		grid-template-columns: 100px 200px 150px 80px 120px	; 
		background-color: #fff;
		color: #444;
    border: 2px dotted red;
}

.box {
		background-color: #444;
		color: #fff;
		border-radius: 5px;
		padding: 20px;
		font-size: 150%;
   display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;center alignment
  	/*     https://stackoverflow.com/questions/9249359/vertically-align-text-within-a-div
https://stackoverflow.com/questions/2939914/how-do-i-vertically-align-text-in-a-div/13515693#13515693*/
}

</style>

<script>

'use strict;'

var controlBreak	=	{}	;
var cssRootRules	=	[]	;

function addRecord() {

}

function valueChanged(thisValue) {
	debugger;
	let thisId			= thisValue.getAttribute('id')					;
	let stimwordPositionAutoIncr	= thisValue.getAttribute('data-stimwordPositionAutoIncr')	;
	let thisValueOf			= document.getElementById(thisId).value				;
	alert(thisId + ' -- ' +  stimwordPositionAutoIncr + ' -- ' +  thisValueOf);
}

function replicationValueClicked(thisValue) {
	let clientContextErrorId = thisValue.getAttribute('data-lastDataItemAdded');
	document.getElementById(clientContextErrorId).value = thisValue.textContent;
}


var lastDataItemAdded = null;	// save this for replication values

function addItem() {
	for ( let rowCount in Object.keys(data) )	{
		let record = data[rowCount] ;
		for ( let columnNbr in Object.keys(data[rowCount]) ) {

			let columnName = Object.keys(data[rowCount])[columnNbr];
			if	(	columnName == 'stimwordWord'
				||	columnName == 'contextPositionSoundPhoneme'
				||	columnName == 'stimwordPositionSetting'
				||	columnName == 'clientContextError'
				||	columnName == 'replicationValue'
				)
			{

				if  (   ( record[columnName] != controlBreak[columnName] )) 
				{ 
					controlBreak[columnName] = record[columnName] ;
					for ( let xx = parseInt(columnNbr) + 1 ; xx < Object.keys(data[rowCount]).length; xx++ )
							// null out all subsequent control-break columns!
					{	console.log(  Object.keys(data[rowCount])[xx] );
						controlBreak[ Object.keys(data[rowCount])[xx]	] = null;  ;
					}

					let cssVarName = '--' + columnName + '--' + (rowCount + 1).toString() ;
					let tag = document.createElement("div");
					let element = null;
					switch ( columnName )	{
						case 'stimwordWord'			:
						case 'contextPositionSoundPhoneme'	:
						case 'stimwordPositionSetting'	:
							element = document.createTextNode(record[columnName]);
							break;
						case 'clientContextError' :
							let elementId = columnName + '-' + rowCount;
							let { stimwordPositionAutoIncr } = record	;
							lastDataItemAdded = elementId;
							element = document.createElement('input');
							element.setAttribute('value'	, record[columnName]			);
							element.setAttribute('id'	, elementId				);
							element.setAttribute('onChange' , 'valueChanged(this);'			);
							element.setAttribute('data-stimwordPositionAutoIncr', stimwordPositionAutoIncr)			;
							tag.appendChild(element);
							break;
						case 'replicationValue'		:
							let textElement = document.createTextNode(record[columnName])	;
							element = document.createElement('span')			;
							element.appendChild(textElement)				;
							element.setAttribute('data-lastDataItemAdded', lastDataItemAdded)			;
							element.setAttribute('onClick' , 'replicationValueClicked(this);' )	;
							break;
					}
					tag.appendChild(element);
	    
					cssRootRules.push	(	{	'columnName'				:	columnName
									,	'cssVarName'				:	cssVarName
									,	'startingRowNbr'			:	rowCount
									,	'endingRowNbr'				:	rowCount
									}
								);

					tag.classList.add(columnName, 'box');
					tag.style.gridRowStart		=	(parseInt(rowCount) + 1 ).toString()	;
					tag.style.gridRowEnd		=	'span var(' + cssVarName + ')'		;
					tag.style.gridColumnStart 	=	(parseInt(columnNbr) + 1).toString()	;
					tag.style.gridColumnEnd		=	(parseInt(columnNbr) + 2).toString()	; 

					document.getElementById('phoneticTranscriptionInputScreen').appendChild(tag);

				} else {
													  //for ( let cssRuleIncr in Object.keys(cssRootRules).reverse() )
					for ( let cssRuleIncr = cssRootRules.length - 1 ; cssRuleIncr >= 0; cssRuleIncr-- )
					{	if  ( cssRootRules[cssRuleIncr].columnName == columnName )
						{
							cssRootRules[cssRuleIncr].endingRowNbr++
							break;
						}

					}
				}
			} // test for printable column item
		} // end for each column item
	} // end for each record
}

function createRootRule() {
	let ruleString = ':root {';
	for ( let incr in cssRootRules ) 
	{	let { startingRowNbr, endingRowNbr, cssVarName } = cssRootRules[incr]	;
		if  ( startingRowNbr != endingRowNbr ) 
		{   //ruleString += (' ' + cssVarName + ': ' + (startingRowNbr + ( endingRowNbr - startingRowNbr ) + 2 ).toString() + ';' ) ; 
		   ruleString += (' ' + cssVarName + ': ' + (( endingRowNbr - startingRowNbr ) + 1 ).toString() + ';' ) ; 
		}
	}
	ruleString += '}';
	document.styleSheets[0].insertRule(ruleString);
}


const data = 
[ { stimwordWord: 'Horse', contextPositionSoundPhoneme:'Initial - h'	, stimwordPositionSetting:'Word'	, clientContextError: '0'	, stimwordPositionAutoIncr: 123123	, replicationValue : 'XYZ'	}
, { stimwordWord: 'Horse', contextPositionSoundPhoneme:'Initial - h'	, stimwordPositionSetting:'Word'	, clientContextError: '0'	, stimwordPositionAutoIncr: 123123	, replicationValue : 'WWW'	}
, { stimwordWord: 'Horse', contextPositionSoundPhoneme:'Initial - h'	, stimwordPositionSetting:'Sentence'	, clientContextError: ''	, stimwordPositionAutoIncr: 123124	, replicationValue : 'ABC'	}
, { stimwordWord: 'Horse', contextPositionSoundPhoneme:'Diphthong - oe'	, stimwordPositionSetting:'Word'	, clientContextError: ''	, stimwordPositionAutoIncr: 123125	, replicationValue : 'DEF'	}
, { stimwordWord: 'Horse', contextPositionSoundPhoneme:'Diphthong - oe'	, stimwordPositionSetting:'Sentence'	, clientContextError: ''	, stimwordPositionAutoIncr: 123126	, replicationValue : 'GHI'	}
, { stimwordWord: 'Horse', contextPositionSoundPhoneme:'Final - S'	, stimwordPositionSetting:'Word'	, clientContextError: ''	, stimwordPositionAutoIncr: 123127	, replicationValue : 'JKL'	}
, { stimwordWord: 'Horse', contextPositionSoundPhoneme:'Final - S'	, stimwordPositionSetting:'Sentence'	, clientContextError: ''	, stimwordPositionAutoIncr: 123128	, replicationValue : 'MNO'	}
]

</script>

</head>

<body>

<div id='phoneticTranscriptionInputScreen' class="wrapper">
						<!--
						  <div class='stimwordWord'>Horse</div>
						  <div class='contextPositionSoundPhoneme'>
						    <span id='contextPosition'>Initial</span>
						    <span id='soundPhoneme'>h</span>
						  </div> 
						  <div class='stimwordPositionSetting'>Word</div>
						  <div class='clientContextError'>
						    <input type="text" value='error-11111'></input>
						  </div>


						<div class='stimwordPositionSetting'>Sentence</div>
						<div class='clientContextError'>
						   <input type="text" value='error-2'></input>
						</div>
						-->
</div>

<br />
<button onClick="javascript: addItem();">Add column</button>
<button onClick="javascript: newRow();">next row</button>
	
</body>
</html>

<!--
/*
function shit()  {

	// https://stackoverflow.com/questions/70251599/how-to-use-cssstylesheet-insertrule-to-change-a-root-property

	let varOne = '--varOne';
	let varTwo = '--varTwo';

	debugger;

	console.log('first loopfind: ' );
	let firstRootVars = loopFind();
	console.log(firstRootVars);
	console.log(getComputedStyle(document.body).getPropertyValue(varOne));
	console.log(getComputedStyle(document.body).getPropertyValue(varTwo));

	document.styleSheets[0].insertRule(":root {" + varOne + ": 1234; }");

	console.log('second loopfind: ' );
	let secondRootVars = loopFind();
	console.log(secondRootVars);
	console.log(getComputedStyle(document.body).getPropertyValue(varOne));
	console.log(getComputedStyle(document.body).getPropertyValue(varTwo));

	document.styleSheets[0].removeRule(0)

	console.log('third loopfind: ' );
	let thirdRootVars = loopFind();
	console.log(thirdRootVars);
	console.log(getComputedStyle(document.body).getPropertyValue(varOne));
	console.log(getComputedStyle(document.body).getPropertyValue(varTwo));

	document.styleSheets[0].insertRule(":root {" + varOne + ": 1234; " + varTwo + ": 5678; }");

	console.log('fourth loopfind: ' );
	let fourthRootVars = loopFind();
	console.log(fourthRootVars);
	console.log(getComputedStyle(document.body).getPropertyValue(varOne));
	console.log(getComputedStyle(document.body).getPropertyValue(varTwo));


}

function loopFind() {

	for ( let x = 0 ; x < document.styleSheets[0].cssRules.length ; x++ ) {
		if ( document.styleSheets[0].cssRules[x].selectorText == ':root' ) {
			document.styleSheets[0].removeRule(x)
			break;
		}
	}
}
*/
/*
var sheet = (function() {
	// Create the <style> tag
	var style = document.createElement("style");

	// WebKit hack :(
	style.appendChild(document.createTextNode(""));

	// Add the <style> element to the page
	document.head.appendChild(style);

	return style.sheet;
})();
*/
-->
